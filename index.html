<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Clock - Crue Chan</title>
    <meta name="description" content="A responsive, minimalist exam clock with dark mode support.">
    <style>
        /* --- CSS Variables for Theming --- */
        :root {
            /* Light Theme (Default) */
            --bg-color: #f4f6f8;
            --text-primary: #2c3e50;
            --text-secondary: #95a5a6;
            --clock-face: #ffffff;
            --clock-border: #2c3e50;
            --clock-tick: #2c3e50;
            --hand-color: #2c3e50;
            --second-hand: #e74c3c;
            --shadow: rgba(0, 0, 0, 0.1);
            --btn-bg: #e0e0e0;
            --btn-text: #333;
        }

        [data-theme="dark"] {
            /* Dark Theme */
            --bg-color: #1a1a1a;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --clock-face: #2c2c2c;
            --clock-border: #ecf0f1;
            --clock-tick: #ecf0f1;
            --hand-color: #ecf0f1;
            --second-hand: #ff6b6b;
            --shadow: rgba(0, 0, 0, 0.5);
            --btn-bg: #333;
            --btn-text: #fff;
        }

        /* --- Global Styles --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- UI Controls (Top Right) --- */
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .btn {
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            outline: none;
        }

        .btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        /* --- Main Content --- */
        h1 {
            margin: 0 0 4vh 0;
            font-weight: 300;
            font-size: 4vh;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .clock-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        canvas {
            border-radius: 50%;
            /* Elegant shadow for depth */
            box-shadow: 0 20px 50px var(--shadow);
            transition: box-shadow 0.3s ease;
        }

        #digital-clock {
            margin-top: 4vh;
            font-family: 'SF Mono', 'Roboto Mono', 'Menlo', monospace; /* Monospaced for tabular numbers */
            font-weight: 300; /* Thin and elegant */
            font-size: 10vw; 
            line-height: 1;
            font-variant-numeric: tabular-nums; /* Critical: keeps numbers strictly aligned */
            letter-spacing: -2px;
            opacity: 0.9;
        }

        /* --- Footer --- */
        footer {
            position: absolute;
            bottom: 20px;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 300;
        }

        footer a {
            color: var(--text-primary);
            text-decoration: none;
            border-bottom: 1px dotted var(--text-secondary);
            transition: color 0.2s;
        }
        
        footer a:hover {
            color: var(--second-hand);
        }

        .fullscreen-hint {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            opacity: 0.5;
            cursor: pointer;
        }

        /* Hide hint on small screens */
        @media (max-width: 600px) {
            .fullscreen-hint { display: none; }
        }
    </style>
</head>
<body>

    <div class="controls">
        <button class="btn" id="btn-lang" onclick="toggleLanguage()">中文</button>
        <button class="btn" id="btn-theme" onclick="toggleTheme()">Dark Mode</button>
    </div>

    <div class="fullscreen-hint" id="hint-text" onclick="toggleFullScreen()">Double-click to Fullscreen</div>

    <h1 id="page-title">Current Time</h1>
    
    <div class="clock-container">
        <canvas id="canvas"></canvas>
        <div id="digital-clock">00:00:00</div>
    </div>

    <footer>
        &copy; 2020-<span id="year"></span> Crue Chan <span style="opacity:0.3">|</span> 
        <a href="https://github.com/cruechan" target="_blank">GitHub</a>
    </footer>

<script>
    /**
     * Configuration & State
     */
    const state = {
        lang: 'en', // 'en' or 'zh'
        theme: 'light' // 'light' or 'dark'
    };

    const i18n = {
        en: {
            title: "Current Time",
            hint: "Double-click to Fullscreen",
            langBtn: "中文",
            themeBtn: "Dark Mode"
        },
        zh: {
            title: "当前时间",
            hint: "双击页面进入全屏",
            langBtn: "English",
            themeBtn: "深色模式" // text changes based on current mode logic below
        }
    };

    // DOM Elements
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const digitalClock = document.getElementById('digital-clock');
    const titleEl = document.getElementById('page-title');
    const hintEl = document.getElementById('hint-text');
    const langBtn = document.getElementById('btn-lang');
    const themeBtn = document.getElementById('btn-theme');

    let radius;

    /**
     * Helper: Get CSS Variable Value
     * Allows Canvas to sync with CSS Theme
     */
    function getCssVar(name) {
        return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }

    /**
     * Core: Resize & Initialization
     */
    function resize() {
        // Occupy 55% of the smallest viewport dimension
        const size = Math.min(window.innerWidth, window.innerHeight) * 0.55;
        const dpr = window.devicePixelRatio || 1;
        
        canvas.width = size * dpr;
        canvas.height = size * dpr;
        canvas.style.width = size + 'px';
        canvas.style.height = size + 'px';
        
        ctx.resetTransform(); // Reset before scaling
        ctx.scale(dpr, dpr);
        
        radius = size / 2;
        ctx.translate(radius, radius);
        radius = radius * 0.90;
        
        drawClock();
    }

    /**
     * Core: Drawing Logic (The Loop)
     */
    function drawClock() {
        // Fetch current theme colors dynamically
        const colors = {
            face: getCssVar('--clock-face'),
            border: getCssVar('--clock-border'),
            tick: getCssVar('--clock-tick'),
            hand: getCssVar('--hand-color'),
            second: getCssVar('--second-hand')
        };

        drawFace(ctx, radius, colors);
        drawTicks(ctx, radius, colors); // Replaces simple numbers with ticks
        drawNumbers(ctx, radius, colors); // Optional: Minimal numbers
        drawTime(ctx, radius, colors);
        updateDigitalTime();
    }

    function drawFace(ctx, radius, colors) {
        ctx.beginPath();
        ctx.arc(0, 0, radius, 0, 2 * Math.PI);
        ctx.fillStyle = colors.face;
        ctx.fill();
        
        // Minimalist border
        ctx.strokeStyle = colors.border;
        ctx.lineWidth = radius * 0.02;
        ctx.stroke();
        
        // Center dot
        ctx.beginPath();
        ctx.arc(0, 0, radius * 0.03, 0, 2 * Math.PI);
        ctx.fillStyle = colors.hand;
        ctx.fill();
    }

    function drawTicks(ctx, radius, colors) {
        ctx.strokeStyle = colors.tick;
        for (let i = 0; i < 60; i++) {
            const angle = (i * Math.PI) / 30;
            ctx.rotate(angle);
            
            ctx.beginPath();
            if (i % 5 === 0) {
                // Hour Ticks (Thicker, Longer)
                ctx.lineWidth = radius * 0.025;
                ctx.moveTo(0, -radius * 0.85);
                ctx.lineTo(0, -radius);
            } else {
                // Minute Ticks (Thinner, Shorter)
                ctx.lineWidth = radius * 0.01;
                ctx.moveTo(0, -radius * 0.92);
                ctx.lineTo(0, -radius);
            }
            ctx.stroke();
            ctx.rotate(-angle);
        }
    }

    function drawNumbers(ctx, radius, colors) {
        ctx.font = `300 ${radius * 0.12}px -apple-system, sans-serif`;
        ctx.textBaseline = "middle";
        ctx.textAlign = "center";
        ctx.fillStyle = colors.tick;
        
        // Draw only main numbers (12, 3, 6, 9) or all 1-12
        // Here we draw all 12 but cleaner
        for (let num = 1; num <= 12; num++) {
            const ang = num * Math.PI / 6;
            ctx.rotate(ang);
            ctx.translate(0, -radius * 0.72); // Move numbers inside ticks
            ctx.rotate(-ang);
            ctx.fillText(num.toString(), 0, 0);
            ctx.rotate(ang);
            ctx.translate(0, radius * 0.72);
            ctx.rotate(-ang);
        }
    }

    function drawTime(ctx, radius, colors) {
        const now = new Date();
        let hour = now.getHours();
        let minute = now.getMinutes();
        let second = now.getSeconds();
        let ms = now.getMilliseconds();

        // Smooth movement for seconds? (Optional: remove ms for ticking step)
        // Let's keep strict ticking for exams (easier to read exact second)
        
        // Hour Hand
        hour = hour % 12;
        hour = (hour * Math.PI / 6) + (minute * Math.PI / (6 * 60));
        drawHand(ctx, hour, radius * 0.55, radius * 0.03, colors.hand);

        // Minute Hand
        minute = (minute * Math.PI / 30) + (second * Math.PI / (30 * 60));
        drawHand(ctx, minute, radius * 0.80, radius * 0.02, colors.hand);

        // Second Hand (Red, thin, with tail)
        second = (second * Math.PI / 30);
        drawHand(ctx, second, radius * 0.85, radius * 0.01, colors.second, true);
    }

    function drawHand(ctx, pos, length, width, color, isSecond = false) {
        ctx.beginPath();
        ctx.lineWidth = width;
        ctx.lineCap = "round";
        ctx.strokeStyle = color;
        ctx.moveTo(0, 0);
        ctx.rotate(pos);
        ctx.lineTo(0, -length);
        
        // Draw tail for second hand
        if (isSecond) {
            ctx.moveTo(0, 0);
            ctx.lineTo(0, length * 0.2);
        }
        
        ctx.stroke();
        ctx.rotate(-pos);
        
        // Second hand pivot dot
        if (isSecond) {
            ctx.beginPath();
            ctx.arc(0, 0, width * 2, 0, 2 * Math.PI);
            ctx.fillStyle = color;
            ctx.fill();
        }
    }

    function updateDigitalTime() {
        const now = new Date();
        // Use 'en-GB' for 24h format 00:00:00
        const timeStr = now.toLocaleTimeString('en-GB', { hour12: false });
        digitalClock.innerText = timeStr;
    }

    /**
     * User Interactions & Logic
     */
    function toggleFullScreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(e => console.log(e));
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
    }

    function toggleLanguage() {
        state.lang = state.lang === 'en' ? 'zh' : 'en';
        updateUI();
    }

    function toggleTheme() {
        state.theme = state.theme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', state.theme);
        updateUI();
        drawClock(); // Force redraw to catch new colors immediately
    }

    function updateUI() {
        const t = i18n[state.lang];
        titleEl.innerText = t.title;
        hintEl.innerText = t.hint;
        langBtn.innerText = t.langBtn;
        
        // Theme button text logic
        if (state.lang === 'en') {
            themeBtn.innerText = state.theme === 'light' ? "Dark Mode" : "Light Mode";
        } else {
            themeBtn.innerText = state.theme === 'light' ? "深色模式" : "浅色模式";
        }
    }

    // Set Copyright Year
    document.getElementById('year').innerText = new Date().getFullYear();

    // Event Listeners
    window.addEventListener('resize', resize);
    window.addEventListener('dblclick', toggleFullScreen);
    
    // Init
    resize();
    setInterval(drawClock, 1000); // 1 FPS is enough for ticking clock

</script>
</body>
</html>